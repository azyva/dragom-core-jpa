<?xml version="1.0" encoding="UTF-8"?>
<entity-mappings version="2.1" xmlns="http://xmlns.jcp.org/xml/ns/persistence/orm" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/persistence/orm http://xmlns.jcp.org/xml/ns/persistence/orm_2_1.xsd">
  <persistence-unit-metadata>
    <xml-mapping-metadata-complete />
  </persistence-unit-metadata>

  <entity class="org.azyva.dragom.model.config.impl.jpa.JpaNodeConfig">
    <table name="NODE"/>
    <inheritance strategy="SINGLE_TABLE"/>
    <discriminator-column name="TYPE" discriminator-type="CHAR" length="1"/>
    <attributes>
      <id name="id">
        <column
          name="ID"
          unique="true"
          nullable="false"/>
        <generated-value strategy="TABLE" generator="gen-node-id"/>
        <table-generator
          name="gen-node-id"
          table="NEXT_ID"
          pk-column-name="ENTITY"
          value-column-name="NEXT_ID"
          pk-column-value="NODE"
          initial-value="1"
          allocation-size="10"/>
      </id>
      <basic name="name">
        <column
          name="NAME"
          nullable="false"/>
      </basic>
      <!-- We do not use the "version" attribute type since optimistic locking is intended
           to be managed by the caller. -->
      <basic name="timestampLastMod">
        <column
          name="TIMESTAMP_LAST_MOD"
          nullable="false"/>
      </basic>
      <many-to-one
        name="jpaClassificationNodeConfigParent"
        target-entity="org.azyva.dragom.model.config.impl.jpa.JpaClassificationNodeConfig">
        <join-column
          name="ID_NODE_PARENT"
          referenced-column-name="ID"/>
        <cascade><cascade-all/></cascade>
      </many-to-one>
      <element-collection
        name="mapPropertyDefConfig"
        target-class="org.azyva.dragom.model.config.impl.simple.SimplePropertyDefConfig">
        <map-key name="name"/>
        <collection-table name="PROPERTY">
          <join-column
            name="ID_NODE"
            referenced-column-name="ID"/>
        </collection-table>
      </element-collection>
    </attributes>
  </entity>

  <entity class="org.azyva.dragom.model.config.impl.jpa.JpaModuleConfig" name="mapPropertyDefConfig">
    <discriminator-value>M</discriminator-value>
  </entity>

  <entity class="org.azyva.dragom.model.config.impl.jpa.JpaClassificationNodeConfig">
    <discriminator-value>C</discriminator-value>
    <attributes>
      <one-to-many
        name="mapJpaNodeConfigChild"
        target-entity="org.azyva.dragom.model.config.impl.jpa.JpaNodeConfig"
        mapped-by="jpaClassificationNodeConfigParent"
        orphan-removal="true">
        <map-key name="name"/>
      </one-to-many>
    </attributes>
  </entity>

  <embeddable class="org.azyva.dragom.model.config.impl.simple.SimplePropertyDefConfig">
    <attributes>
      <basic name="name">
        <column
          name="NAME"
          nullable="false"/>
      </basic>
      <basic name="value">
        <column
          name="VALUE"/>
      </basic>
      <basic name="indOnlyThisNode">
        <column
          name="IND_ONLY_THIS_NODE"
          nullable="false"/>
      </basic>
    </attributes>
  </embeddable>

  <embeddable class="org.azyva.dragom.model.config.impl.simple.SimplePluginDefConfig">
    <attributes>
      <basic name="classNodePlugin">
        <column
          name="INTERFACE"
          nullable="false"/><convert converter="org.azyva.dragom.model.config.impl.jpa.ClassAttributeConverter"></convert>
      </basic>
      <basic name="pluginId">
        <column
          name="PLUGIN_ID"/>
      </basic>
      <basic name="pluginClass">
        <column
          name="CLASS"/>
      </basic>
      <basic name="indOnlyThisNode">
        <column
          name="IND_ONLY_THIS_NODE"
          nullable="false"/>
      </basic>
    </attributes>
  </embeddable>
</entity-mappings>
